好的，这是基于您当前项目代码的汇报报告，包含图文并茂的系统架构图和各模块结构图，以及 Markdown 格式的详细说明。

# X|act 系统汇报报告

## 1. 项目概述

本项目是一个集成了 X 射线控制、CNC 控制、探测器控制和图像处理功能的综合系统。旨在提供一个完整的解决方案，用于 X 射线成像和分析。

## 2. 系统架构

### 2.1 总体架构图

````markdown

​````plantuml
@startuml X|act System Architecture

!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

LAYOUT_WITH_LEGEND()

title X|act System Architecture

Container_Boundary(frontend, "Frontend") {
    Component(react, "React Application", "TypeScript, React 18", "前端核心应用框架")
    Component(pixijs, "PixiJS", "JavaScript", "图像渲染引擎")
    Component(webview, "WebView", "C++/MFC or Qt", "Web容器")
    
    Container_Boundary(ui_components, "UI Components") {
        Component(layout, "XactLayout", "React", "主布局组件")
        Component(imageviewer, "ImageViewer", "React + PixiJS", "图像查看器")
        Component(imagecontrols, "ImageControls", "React", "图像控制面板")
        Component(menus, "Menu System", "React", "菜单系统")
    }

    Container_Boundary(state_management, "State Management") {
        Component(hooks, "React Hooks", "React", "状态管理")
        Component(refs, "React Refs", "React", "DOM引用管理")
    }
}

Container_Boundary(backend, "Backend") {
    Component(cpp_core, "C++ Core", "C++", "后端核心逻辑")
    Component(image_processing, "Image Processing", "C++", "图像处理模块")
    Component(xray_control, "X-Ray Control", "C++", "X射线控制")
    Component(hardware_interface, "Hardware Interface", "C++", "硬件接口")
}

Container_Boundary(bridge, "Frontend-Backend Bridge") {
    Component(ipc, "IPC Communication", "WebView", "进程间通信")
    Component(api, "Native API", "C++", "本地API接口")
}

' 关系连接
Rel(react, webview, "运行于")
Rel(webview, ipc, "通信")
Rel(ipc, api, "调用")
Rel(api, cpp_core, "集成")

Rel(layout, ui_components, "包含")
Rel(imageviewer, pixijs, "使用")
Rel(ui_components, hooks, "使用")
Rel(ui_components, refs, "使用")

Rel(cpp_core, image_processing, "调用")
Rel(cpp_core, xray_control, "控制")
Rel(cpp_core, hardware_interface, "访问")

@enduml
````

**架构说明：**

*   **前端 (Frontend):**
    *   使用 React 框架构建用户界面。
    *   使用 PixiJS 渲染图像和 Overlay。
    *   通过 WebView 容器承载 React 应用。
    *   包含各种 UI 组件，如主布局、图像查看器、图像控制面板和菜单系统。
    *   使用 React Hooks 和 Refs 进行状态管理和 DOM 引用。
*   **后端 (Backend):**
    *   使用 C++ 构建后端核心逻辑。
    *   包含图像处理模块、X 射线控制模块和硬件接口模块。
*   **桥接 (Frontend-Backend Bridge):**
    *   使用 WebView 进行进程间通信 (IPC)。
    *   通过 Native API 提供本地 API 接口。

### 2.2 模块结构图

#### 2.2.1 X 射线控制模块

````plantuml
@startuml X-Ray Control Module

component XrayControl {
    [XrayControl.jsx] as XrayControlComponent
    [XrayService.js] as XrayService
    [DeviceHandler.cpp] as DeviceHandlerCpp
    [CXray.cpp] as CXrayCpp
    [CXray.h] as CXrayH
}

Rel(XrayControlComponent, XrayService, "使用")
Rel(XrayService, DeviceHandlerCpp, "调用")
Rel(DeviceHandlerCpp, CXrayCpp, "控制")
Rel(CXrayCpp, CXrayH, "实现")

@enduml
````

**模块说明：**

*   **XrayControl.jsx:** React 组件，提供 X 射线控制的用户界面。
*   **XrayService.js:** JavaScript 服务，封装 X 射线控制的 API 调用。
*   **DeviceHandler.cpp:** C++ 类，处理来自前端的 X 射线控制请求。
*   **CXray.cpp/CXray.h:** C++ 类，实现 X 射线设备的具体控制逻辑。

#### 2.2.2 CNC 控制模块

````plantuml
@startuml CNC Control Module

component CNCControl {
    [ManipulatorControl.jsx] as ManipulatorControlComponent
    [DeviceHandler.cpp] as DeviceHandlerCpp
    [CCnc.cpp] as CCncCpp
    [CCnc.h] as CCncH
}

Rel(ManipulatorControlComponent, DeviceHandlerCpp, "调用")
Rel(DeviceHandlerCpp, CCncCpp, "控制")
Rel(CCncCpp, CCncH, "实现")

@enduml
````

**模块说明：**

*   **ManipulatorControl.jsx:** React 组件，提供 CNC 控制的用户界面。
*   **DeviceHandler.cpp:** C++ 类，处理来自前端的 CNC 控制请求。
*   **CCnc.cpp/CCnc.h:** C++ 类，实现 CNC 设备的具体控制逻辑。

#### 2.2.3 探测器控制模块

````plantuml
@startuml Detector Control Module

component DetectorControl {
    [DetectorControl.jsx] as DetectorControlComponent
    [DetectorService.js] as DetectorService
    [DeviceHandler.cpp] as DeviceHandlerCpp
    [CDigGrabber.cpp] as CDigGrabberCpp
    [CDigGrabber.h] as CDigGrabberH
}

Rel(DetectorControlComponent, DetectorService, "使用")
Rel(DetectorService, DeviceHandlerCpp, "调用")
Rel(DeviceHandlerCpp, CDigGrabberCpp, "控制")
Rel(CDigGrabberCpp, CDigGrabberH, "实现")

@enduml
````

**模块说明：**

*   **DetectorControl.jsx:** React 组件，提供探测器控制的用户界面。
*   **DetectorService.js:** JavaScript 服务，封装探测器控制的 API 调用。
*   **DeviceHandler.cpp:** C++ 类，处理来自前端的探测器控制请求。
*   **CDigGrabber.cpp/CDigGrabber.h:** C++ 类，实现探测器的具体控制逻辑。

#### 2.2.4 图像展示 + Overlay 模块

````plantuml
@startuml Image Display and Overlay Module

component ImageDisplay {
    [ImageViewer.jsx] as ImageViewerComponent
    [OverlayCanvas.jsx] as OverlayCanvas
    [ImageDataService.js] as ImageDataService
    [DeviceHandler.cpp] as DeviceHandlerCpp
}

Rel(ImageViewerComponent, OverlayCanvas, "包含")
Rel(ImageViewerComponent, ImageDataService, "使用")
Rel(ImageDataService, DeviceHandlerCpp, "调用")

@enduml
````

**模块说明：**

*   **ImageViewer.jsx:** React 组件，使用 PixiJS 渲染图像，并提供 Overlay 功能。
*   **OverlayCanvas.jsx:** React 组件，实现 Overlay 绘图功能。
*   **ImageDataService.js:** JavaScript 服务，负责获取图像数据。
*   **DeviceHandler.cpp:** C++ 类，提供图像数据。

## 3. 核心功能

*   **X 射线控制:**
    *   控制 X 射线设备的开关、电压、电流和聚焦模式。
    *   实时显示 X 射线设备的状态。
*   **CNC 控制:**
    *   控制 CNC 设备的运动，包括轴的移动、停止和参考。
    *   支持摇杆控制。
*   **探测器控制:**
    *   控制探测器的实时采集、增益、FPS 和积分。
    *   提供图像处理功能，如滤镜。
*   **图像展示 + Overlay:**
    *   使用 PixiJS 渲染图像。
    *   提供 Overlay 绘图功能，包括箭头、圆形、矩形和文本。
    *   支持图像的旋转、缩放和保存。

## 4. 技术栈

*   **前端:**
    *   React
    *   PixiJS
    *   Tailwind CSS
*   **后端:**
    *   C++
    *   MFC (或 Qt)
*   **通信:**
    *   WebView2
    *   IPC

## 5. 总结

本项目成功地集成了 X 射线控制、CNC 控制、探测器控制和图像处理功能，提供了一个完整的解决方案。通过前后端分离的架构，实现了良好的可维护性和可扩展性。
````

请注意，这只是一个基本的报告框架，您可以根据实际情况进行修改和补充。例如，您可以添加更多关于每个模块的详细信息，以及项目的未来发展方向。
请注意，这只是一个基本的报告框架，您可以根据实际情况进行修改和补充。例如，您可以添加更多关于每个模块的详细信息，以及项目的未来发展方向。
````